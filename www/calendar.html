<!DOCTYPE html>
<!-- Giovanni Romano - 120324160
	 Matthew Treichel - 120585470 -->
<html>
<head>
	<title>Recipe QuickList</title>
	<!-- jQuery setup -->
	<meta name="viewport" content="width=device-width, initial-scale=1" charset="utf-8"></meta>
		<link rel="stylesheet" href="jquery/jquery.mobile-1.4.5.css" />
		<link rel="stylesheet" href="css/index.css" />
		<script src="jquery/jquery-1.11.3.min.js"></script>
		<script src="jquery/jquery.mobile-1.4.5.js"></script>
		<link rel='stylesheet' href='fullcalendar-2.4.0/fullcalendar.css' />
		<script src='fullcalendar-2.4.0/lib/moment.min.js'></script>
		<script src='fullcalendar-2.4.0/fullcalendar.js'></script>
</head>

<body>
	<!-- header -->
	<div data-role="header" data-theme="b">
		<a onclick="goHome()" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-icon-arrow-l">Back</a>
		<h1>Recipe QuickList</h1>
		<a onclick="goHome()" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-home">Home</a>
	</div>
	
	<div id="recipePicker" data-role="popup">
		<select id="recipeSelect"></select>
		<input type="button" value="Place this Recipe" id="pickRecipeButton"/>
	</div>
	
	<br>
	
	<div id="calendar"></div>
	<script>
		loadRecipes();
		function goHome() {
			$.mobile.changePage( "index.html", { transition: "slide", changeHash: false });
		}
		$(document).ready(function() {
			$('#calendar').fullCalendar({
				//Should Load Events from LocalStorage into Calendar
				//Will also need to update LocalStorage on drag, there's definitely a function for that
				eventStartEditable : true, //Draggable Events
				selectable: true,
				select: function(start, end) {
					$("#recipePicker").popup("open");
					$("#pickRecipeButton").unbind().click(function(){
						var eventData;
						var val = $("#recipeSelect").find(":selected").text();
						eventData = {
							title: val,
							start: start,
							end: end
						};
						$('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
						
						var dateData = localStorage.getItem(start);
						if (dateData === null) {
							localStorage.setItem(start, val); //Will Need to Filter out Dates from Recipes in other areas
						} else {
							dateData = dateData.concat("," + val); //Yes, I'm concatenating within concatenating
							localStorage.setItem(start, dateData);
						}
						
						$("#recipePicker").popup("close");
					});
				},
			});
		});
				
		function loadRecipes() {
			var select = document.getElementById('recipeSelect');
            for (var i = 0, retrievedRecipe = null, option = null; i < localStorage.length; i++) {
				retrievedRecipe = localStorage.getItem(localStorage.key(i)).split(/,|:/);
				option = document.createElement('option');
				option.value = retrievedRecipe[1];
				option.innerHTML = retrievedRecipe[1];
				select.appendChild(option);
            }
		}
	</script>
</body>
</html>